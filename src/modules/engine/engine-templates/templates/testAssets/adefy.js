/* Copyright Â© 2013 Spectrum IT Solutions Gmbh - All Rights Reserved */
var AJS,AJSBaseActor,AJSColor3,AJSPolygon,AJSRectangle,AJSTriangle,AJSUtilParam,AJSVector2,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};AJSUtilParam=function(){function a(){}return a.required=function(a,b){var c,d,e,f;if(void 0===a)throw new Error("Required argument missing!");if(b instanceof Array){for(c=!1,e=0,f=b.length;f>e;e++)if(d=b[e],a===d){c=!0;break}if(!c)throw new error("Required argument is not of a valid value!")}return a},a.optional=function(a,b,c){var d,e,f,g;if(void 0===a&&(a=b),c instanceof Array){for(d=!1,f=0,g=c.length;g>f;f++)if(e=c[f],a===e){d=!0;break}if(!d)throw new error("Required argument is not of a valid value!")}return a},a}(),void 0===window.param&&(window.param=AJSUtilParam),AJSVector2=function(){function a(a,b){this.x=a||0,this.y=b||0}return a.prototype.negative=function(){return new a(-this.x,-this.y)},a.prototype.add=function(b){return b instanceof a?new a(this.x+b.x,this.y+b.y):new a(this.x+b,this.y+b)},a.prototype.subtract=function(b){return b instanceof a?new a(this.x-b.x,this.y-b.y):new a(this.x-b,this.y-b)},a.prototype.multiply=function(b){return b instanceof a?new a(this.x*b.x,this.y*b.y):new a(this.x*b,this.y*b)},a.prototype.divide=function(b){return b instanceof a?new a(this.x/b.x,this.y/b.y):new a(this.x/b,this.y/b)},a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y},a.prototype.cross=function(a){return this.x*a.y-this.y*a.x},a.prototype.ortho=function(){return new a(this.y,-this.x)},a.prototype.length=function(){return Math.sqrt(this.dot(this))},a.prototype.normalize=function(){return this.divide(this.length())},a.prototype.toString=function(){return"("+this.x+", "+this.y+")"},a}(),AJSBaseActor=function(){function a(a,b,c,d){var e;if(this._verts=a,param.required(this._verts),this._m=param.optional(b,0),this._f=param.optional(c,.2),this._e=param.optional(d,.3),0>b&&(b=0),this._verts.length<6)throw"At least three vertices must be provided";if(this._psyx=!1,e=void 0===this._texverts?void 0:JSON.stringify(this._texverts),this._id=window.AdefyGLI.Actors().createActor(JSON.stringify(this._verts),e),-1===this._id)throw"Failed to create actor!";this.setPosition(new AJSVector2),this.setRotation(0),this.setColor(new AJSColor3(255,255,255))}return a.prototype.destroy=function(){return window.AdefyGLI.Actors().destroyActor(this._id)},a.prototype._setPhysicsVertices=function(a){return window.AdefyGLI.Actors().setPhysicsVertices(JSON.stringify(a),this._id)},a.prototype._setRenderMode=function(a){return window.AdefyGLI.Actors().setRenderMode(param.required(a,[1,2]),this._id)},a.prototype._updateVertices=function(){return window.AdefyGLI.Actors().updateVertices(JSON.stringify(this._verts),this._id)},a.prototype._fetchVertices=function(){return this._verts=JSON.parse(window.AdefyGLI.Actors().getVertices(this._id))},a.prototype.getId=function(){return this._id},a.prototype.setPosition=function(a){return this._position=a,window.AdefyGLI.Actors().setActorPosition(a.x,a.y,this._id),this},a.prototype.setRotation=function(a,b){return b!==!0&&(b=!1),this._rotation=a,window.AdefyGLI.Actors().setActorRotation(a,this._id,b),this},a.prototype.getPosition=function(){var a;return a=JSON.parse(window.AdefyGLI.Actors().getActorPosition(this._id)),new AJSVector2(a.x,a.y)},a.prototype.getRotation=function(a){return a!==!0&&(a=!1),window.AdefyGLI.Actors().getActorRotation(this._id,a)},a.prototype.setColor=function(a){return window.AdefyGLI.Actors().setActorColor(a._r,a._g,a._b,this._id),this},a.prototype.setTexture=function(a){return window.AdefyGLI.Actors().setTexture(a,this._id),this},a.prototype.getColor=function(){var a;return a=JSON.parse(window.AdefyGLI.Actors().getActorColor(this._id)),new AJSColor3(a.r,a.g,a.b)},a.prototype.hasPsyx=function(){return this._psyx},a.prototype.enablePsyx=function(a,b,c){return this._m=param.optional(a,this._m),this._f=param.optional(b,this._f),this._e=param.optional(c,this._e),this._psyx=window.AdefyGLI.Actors().enableActorPhysics(this._m,this._f,this._e,this._id),this},a.prototype.disablePsyx=function(){return window.AdefyGLI.Actors().destroyPhysicsBody(this._id)&&(this._psyx=!1),this},a.prototype.mapAnimation=function(){return null},a.prototype.canMapAnimation=function(){return!1},a.prototype.absoluteMapping=function(){return!1},a.prototype.rotate=function(a,b,c,d){return param.required(a),void 0===b?(this.setRotation(a),this):(void 0===c&&(c=0),void 0===d&&(d=[]),AJS.animate(this,[["rotation"]],[{endVal:a,controlPoints:d,duration:b,property:"rotation",start:c}]),this)},a.prototype.move=function(a,b,c,d,e){return void 0===c?((null===a||void 0===a)&&(a=this.getPosition().x),(null===b||void 0===b)&&(b=this.getPosition().y),this.setPosition({x:a,y:b}),this):(void 0===d&&(d=0),void 0===e&&(e=[]),null!==a&&AJS.animate(this,[["position","x"]],[{endVal:a,controlPoints:e,duration:c,start:d}]),null!==b&&AJS.animate(this,[["position","y"]],[{endVal:b,controlPoints:e,duration:c,start:d}]),this)},a.prototype.colorTo=function(a,b,c,d,e,f){return void 0===d?((null===a||void 0===a)&&(a=this.getColor().r),(null===b||void 0===b)&&(b=this.getColor().g),(null===c||void 0===c)&&(c=this.getColor().b),this.setColor({_r:a,_g:b,_b:c}),this):(void 0===e&&(e=0),void 0===f&&(f=[]),null!==a&&AJS.animate(this,[["color","r"]],[{endVal:a,controlPoints:f,duration:d,start:e}]),null!==b&&AJS.animate(this,[["color","g"]],[{endVal:b,controlPoints:f,duration:d,start:e}]),null!==c&&AJS.animate(this,[["color","b"]],[{endVal:c,controlPoints:f,duration:d,start:e}]),this)},a}(),AJSColor3=function(){function a(a,b,c){this._r=param.optional(a,0),this._g=param.optional(b,0),this._b=param.optional(c,0)}return a.prototype.getR=function(a){return a!==!0?this._r:0===this._r?a?0:0:this._r/255},a.prototype.getG=function(a){return a!==!0?this._g:0===this._g?a?0:0:this._g/255},a.prototype.getB=function(a){return a!==!0?this._b:0===this._b?a?0:0:this._b/255},a.prototype.setR=function(a){return 0>a&&(a=0),a>255&&(a=255),this._r=a},a.prototype.setG=function(a){return 0>a&&(a=0),a>255&&(a=255),this._g=a},a.prototype.setB=function(a){return 0>a&&(a=0),a>255&&(a=255),this._b=a},a.prototype.toString=function(){return"("+this._r+", "+this._g+", "+this._b+")"},a}(),AJSRectangle=function(a){function b(a){if(a=param.required(a),this._w=param.required(a.w),this._h=param.required(a.h),this._w<=0)throw"Width must be greater than 0";if(this._h<=0)throw"Height must be greater than 0";this._texverts=[0,0,1,0,1,1,0,1,0,0],this._rebuildVerts(),b.__super__.constructor.call(this,this._verts,a.mass,a.friction,a.elasticity),a.color instanceof AJSColor3?this.setColor(a.color):void 0!==a.color&&void 0!==a.color.r&&this.setColor(new AJSColor3(a.color.r,a.color.g,a.color.b)),a.position instanceof AJSVector2?this.setPosition(a.position):void 0!==a.position&&void 0!==a.position.x&&this.setPosition(new AJSVector2(a.position.x,a.position.y)),"number"==typeof a.rotation&&this.setRotation(a.rotation),a.psyx&&this.enablePsyx()}return __extends(b,a),b.prototype.getWidth=function(){return this._fetchVertices(),this._w=2*this._verts[4]},b.prototype.getHeight=function(){return this._fetchVertices(),this._h=2*this._verts[3]},b.prototype._rebuildVerts=function(){var a,b;return b=this._w/2,a=this._h/2,this._verts=[],this._verts.push(-b),this._verts.push(-a),this._verts.push(-b),this._verts.push(a),this._verts.push(b),this._verts.push(a),this._verts.push(b),this._verts.push(-a),this._verts.push(-b),this._verts.push(-a)},b.prototype.setHeight=function(a){if(param.required(a),0>=a)throw new Error("New height must be >0 !");return this._h=a,this._rebuildVerts(),this._updateVertices(),this},b.prototype.setWidth=function(a){if(param.required(a),0>=a)throw new Error("New width must be >0 !");return this._w=a,this._rebuildVerts(),this._updateVertices(),this},b.prototype.mapAnimation=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q=this;if(param.required(a),param.required(c),e={},h=function(a){return a=0===a?".":a>=0?"+"+a:""+a},"width"===a[0]){for(c.startVal/=2,c.endVal/=2,d=JSON.stringify(c),f=window.AdefyGLI.Animations().preCalculateBez(d),f=JSON.parse(f),g=0,c.deltas=[],c.delays=[],c.udata=[],i=Number(f.values[0]),o=f.values,k=0,m=o.length;m>k;k++)j=o[k],j=Number(j),j-=i,i+=j,g+=Number(f.stepTime),0!==j&&(c.deltas.push([h(-j),".",h(-j),".",h(j),".",h(j),".",h(-j),"."]),c.udata.push(2*j),c.delays.push(g));c.cbStep=function(a){return q._w+=2*a},e.property=["vertices"],e.options=c}else{if("height"!==a[0])return b.__super__.mapAnimation.call(this,a,c);for(c.startVal/=2,c.endVal/=2,d=JSON.stringify(c),f=window.AdefyGLI.Animations().preCalculateBez(d),f=JSON.parse(f),g=0,c.deltas=[],c.delays=[],c.udata=[],i=Number(f.values[0]),p=f.values,l=0,n=p.length;n>l;l++)j=p[l],j=Number(j),j-=i,i+=j,g+=Number(f.stepTime),0!==j&&(c.deltas.push([".",h(-j),".",h(j),".",h(j),".",h(-j),".",h(-j)]),c.udata.push(j),c.delays.push(g));c.cbStep=function(a){return q._h+=2*a},e.property=["vertices"],e.options=c}return e},b.prototype.canMapAnimation=function(a){return"height"===a[0]||"width"===a[0]?!0:!1},b.prototype.absoluteMapping=function(){return!1},b.prototype.setTexture=function(a){return param.required(a),window.AdefyGLI.Actors().setActorTexture(a,this._id),this},b.prototype.resize=function(a,b,c,d,e,f,g){var h,i;return a=param.optional(a,null),b=param.optional(b,null),void 0===e?(null!==a&&this.setWidth(a),null!==b&&this.setHeight(b),this):(void 0===f&&(f=0),void 0===g&&(g=[]),i=[],h=[],null!==a&&(param.required(c),i.push(["width"]),h.push({endVal:a,startVal:c,controlPoints:g,duration:e,start:f,property:"width"})),null!==b&&(param.required(d),i.push(["height"]),h.push({endVal:b,startVal:d,controlPoints:g,duration:e,start:f,property:"height"})),i.length>0&&AJS.animate(this,i,h),this)},b}(AJSBaseActor),AJSTriangle=function(a){function b(a){if(a=param.required(a),this._base=param.required(a.base),this._height=param.required(a.height),this._base<=0)throw"Base must be wider than 0";if(this._height<=0)throw"Height must be greater than 0";this._rebuildVerts(),b.__super__.constructor.call(this,this._verts,a.mass,a.friction,a.elasticity),a.color instanceof AJSColor3?this.setColor(a.color):void 0!==a.color&&void 0!==a.color.r&&this.setColor(new AJSColor3(a.color.r,a.color.g,a.color.b)),a.position instanceof AJSVector2?this.setPosition(a.position):void 0!==a.position&&void 0!==a.position.x&&this.setPosition(new AJSVector2(a.position.x,a.position.y)),"number"==typeof a.rotation&&this.setRotation(a.rotation),a.psyx&&this.enablePsyx()}return __extends(b,a),b.prototype.getBase=function(){return this._fetchVertices(),this._base=2*this._verts[4]},b.prototype.getHeight=function(){return this._fetchVertices(),this._height=2*this._verts[3]},b.prototype._rebuildVerts=function(){var a,b;return a=this._base/2,b=this._height/2,this._verts=[8],this._verts[0]=-a,this._verts[1]=-b,this._verts[2]=0,this._verts[3]=b,this._verts[4]=a,this._verts[5]=-b,this._verts[6]=-a,this._verts[7]=-b},b.prototype.setHeight=function(a){if(param.required(a),0>=a)throw new Error("New height must be >0 !");return this._height=a,this._rebuildVerts(),this._updateVertices(),this},b.prototype.setBase=function(a){if(param.required(a),0>=a)throw new Error("New base must be >0 !");return this._base=a,this._rebuildVerts(),this._updateVertices(),this},b.prototype.mapAnimation=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q=this;if(param.required(a),param.required(c),e={},h=function(a){return a=0===a?".":a>=0?"+"+a:""+a},"height"===a[0]){for(c.startVal/=2,c.endVal/=2,d=JSON.stringify(c),f=window.AdefyGLI.Animations().preCalculateBez(d),f=JSON.parse(f),g=0,c.deltas=[],c.delays=[],c.udata=[],i=Number(f.values[0]),o=f.values,k=0,m=o.length;m>k;k++)j=o[k],j=Number(j),j-=i,i+=j,g+=Number(f.stepTime),0!==j&&(c.deltas.push([".",h(-j),".",h(j),".",h(-j),".",h(-j)]),c.udata.push(j),c.delays.push(g));c.cbStep=function(a){return q._height+=2*a},e.property=["vertices"],e.options=c}else{if("base"!==a[0])return b.__super__.mapAnimation.call(this,a,c);for(c.startVal/=2,c.endVal/=2,d=JSON.stringify(c),f=window.AdefyGLI.Animations().preCalculateBez(d),f=JSON.parse(f),g=0,c.deltas=[],c.delays=[],c.udata=[],i=Number(f.values[0]),p=f.values,l=0,n=p.length;n>l;l++)j=p[l],j=Number(j),j-=i,i+=j,g+=Number(f.stepTime),0!==j&&(c.deltas.push([h(-j),".",".",".",h(j),".",h(-j),"."]),c.udata.push(j),c.delays.push(g));c.cbStep=function(a){return q._base+=2*a},e.property=["vertices"],e.options=c}return e},b.prototype.canMapAnimation=function(a){return"base"===a[0]||"height"===a[0]?!0:!1},b.prototype.absoluteMapping=function(){return!1},b.prototype.resize=function(a,b,c,d,e,f,g){var h,i;return a=param.optional(a,null),b=param.optional(b,null),void 0===e?(null!==a&&this.setBase(a),null!==b&&this.setHeight(b),this):(void 0===f&&(f=0),void 0===g&&(g=[]),i=[],h=[],null!==a&&(param.required(c),i.push(["base"]),h.push({endVal:a,startVal:c,controlPoints:g,duration:e,start:f,property:"base"})),null!==b&&(param.required(d),i.push(["height"]),h.push({endVal:b,startVal:d,controlPoints:g,duration:e,start:f,property:"height"})),i.length>0&&AJS.animate(this,i,h),this)},b}(AJSBaseActor),AJSPolygon=function(a){function b(a){if(param.required(a),this._radius=param.required(a.radius),this._segments=param.required(a.segments),a.psyx=param.optional(a.psyx,!1),this._radius<=0)throw"Radius must be larger than 0";if(this._segments<3)throw"Shape must consist of at least 3 segments";this._rebuildVerts(!0),b.__super__.constructor.call(this,this._verts,a.mass,a.friction,a.elasticity),a.color instanceof AJSColor3?this.setColor(a.color):void 0!==a.color&&void 0!==a.color.r&&this.setColor(new AJSColor3(a.color.r,a.color.g,a.color.b)),a.position instanceof AJSVector2?this.setPosition(a.position):void 0!==a.position&&void 0!==a.position.x&&this.setPosition(new AJSVector2(a.position.x,a.position.y)),"number"==typeof a.rotation&&this.setRotation(a.rotation),a.psyx&&this.enablePsyx(),this._setPhysicsVertices(this._verts.slice(0,this._verts.length-2)),this._setRenderMode(2)}return __extends(b,a),b.prototype._rebuildVerts=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(a=param.optional(a,!1),b=param.optional(b,!1),c=param.optional(c,this._segments),d=param.optional(d,this._radius),m=d,n=0,i=6.2831852/c,h=Math.tan(i),g=Math.cos(i),l=[],e=o=0;c>=0?c>o:o>c;e=c>=0?++o:--o)f=2*e,l[f]=m,l[f+1]=n,j=-n,k=m,m+=j*h,n+=k*h,m*=g,n*=g;for(l.push(l[0]),l.push(l[1]),r=[],e=p=0,q=l.length;q>p;e=p+=2)s=l[l.length-2-e],t=l[l.length-1-e],b?r.push("`"+s):r.push(s),b?r.push("`"+t):r.push(t);return l=r,a||b||this._setPhysicsVertices(l),b?l.push("`0"):l.push(0),b?l.push("`0"):l.push(0),b?l:this._verts=l},b.prototype.setRadius=function(a){if(param.required(a),0>=a)throw new Error("New radius must be >0 !");return this._radius=a,this._rebuildVerts(),this._updateVertices(),this},b.prototype.setSegments=function(a){if(param.required(a),3>a)throw new Error("New segment count must be >=3 !");return this._segments=a,this._rebuildVerts(),this._updateVertices(),this},b.prototype.getRadius=function(){return this._radius},b.prototype.getSegments=function(){return this._segments},b.prototype.mapAnimation=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=this;if(param.required(a),param.required(c),e={},this._fetchVertices(),h=function(a){return a=0===a?".":a>=0?"+"+a:""+a},d=JSON.stringify(c),"radius"===a[0]){for(f=window.AdefyGLI.Animations().preCalculateBez(d),f=JSON.parse(f),g=0,c.deltas=[],c.delays=[],c.udata=[],n=f.values,j=0,l=n.length;l>j;j++)i=n[j],i=Number(i),g+=Number(f.stepTime),0!==i&&(c.udata.push(i),c.deltas.push(this._rebuildVerts(!0,!0,this._segments,i)),c.delays.push(g));c.cbStep=function(a){return p._radius=a},e.property=["vertices"],e.options=c}else{if("sides"!==a[0])return b.__super__.mapAnimation.call(this,a,c);for(f=window.AdefyGLI.Animations().preCalculateBez(d),f=JSON.parse(f),g=0,c.deltas=[],c.delays=[],c.udata=[],o=f.values,k=0,m=o.length;m>k;k++)i=o[k],i=Number(i),g+=Number(f.stepTime),0!==i&&(c.udata.push(i),c.deltas.push(this._rebuildVerts(!0,!0,i,this._radius)),c.delays.push(g));c.cbStep=function(a){return p._segments=a},e.property=["vertices"],e.options=c}return e},b.prototype.canMapAnimation=function(a){return"sides"===a[0]||"radius"===a[0]?!0:!1},b.prototype.absoluteMapping=function(){return!0},b}(AJSBaseActor),AJS=function(){function a(){throw new Error("AJS shouldn't be instantiated!")}return a._engine=null,a._initialized=!1,a.init=function(b,c,d){if(param.required(b),param.required(c),param.required(d),a._initialized)throw new Error("AJS can only be initialized once");return a._initialized=!0,this._engine=window.AdefyGLI.Engine(),this._engine.initialize(function(a){return b(a)},c,d,1,"")},a.setClearColor=function(a,b,c){return param.required(a),param.required(b),param.required(c),window.AdefyGLI.Engine().setClearColor(a,b,c)},a.getClearColor=function(){var a;return a=JSON.parse(window.AdefyGLI.Engine().getClearColor()),new AJSColor3(a.r,a.g,a.b)},a.setLogLevel=function(a){return param.required(a,[0,1,2,3,4]),window.AdefyGLI.Engine().setLogLevel(a)},a._syntheticMap={width:""},a.animate=function(b,c,d,e,f){var g,h,i,j,k,l,m,n;for(param.required(b),param.required(c),param.required(d),e=param.optional(e,0),f=param.optional(f,30),g=window.AdefyGLI.Animations(),m=function(b,c,d,e){return setTimeout(function(){var e;return e=a.mapAnimation(b,c,d),c=JSON.stringify(e.property),d=JSON.stringify(e.options),g.animate(b.getId(),c,d)},e)},n=[],h=k=0,l=c.length;l>=0?l>k:k>l;h=l>=0?++k:--k)if(void 0===d[h].fps&&(d[h].fps=f),void 0===d[h].start&&(d[h].start=e),g.canAnimate(c[h][0]))d[h]=JSON.stringify(d[h]),c[h]=JSON.stringify(c[h]),n.push(g.animate(b.getId(),c[h],d[h]));else{if(!b.canMapAnimation(c[h]))throw new Error("Unrecognized property! "+c[h]);b.absoluteMapping(c[h])?(j=d[h].start,d[h].start=-1,n.push(m(b,c[h],d[h],j))):(i=a.mapAnimation(b,c[h],d[h]),c[h]=JSON.stringify(i.property),d[h]=JSON.stringify(i.options),n.push(g.animate(b.getId(),c[h],d[h])))}return n},a.mapAnimation=function(a,b,c){return param.required(a),param.required(b),param.required(c),a.mapAnimation(b,c)},a.loadManifest=function(a,b){return param.required(a),b=param.optional(b,function(){}),window.AdefyGLI.Engine().loadManifest(a,b)},a.createRectangleActor=function(a,b,c,d,e,f,g){return param.required(a),param.required(b),param.required(c),param.required(d),new AJSRectangle({position:{x:a,y:b},color:{r:e,g:f,b:g},w:c,h:d})},a.createSquareActor=function(b,c,d,e,f,g){return a.createRectangleActor(b,c,d,d,e,f,g)},a.createCircleActor=function(a,b,c,d,e,f){return param.required(a),param.required(b),param.required(c),new AJSPolygon({position:{x:a,y:b},color:{r:d,g:e,b:f},radius:c,segments:32})},a.createTriangleActor=function(a,b,c,d,e,f,g){return param.required(a),param.required(b),param.required(c),param.required(d),void 0===e&&(e=Math.floor(255*Math.random())),void 0===f&&(f=Math.floor(255*Math.random())),void 0===g&&(g=Math.floor(255*Math.random())),new AJSTriangle({position:{x:a,y:b},color:{r:e,g:f,b:g},base:c,height:d})},a}();
